<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Interface Serre ConnectÃ©e</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <header>
    <div><strong>Serre ConnectÃ©e</strong></div>
    <nav>
      <a href="#">Accueil</a>
      <a href="#">MÃ©tÃ©o</a>
      <a href="#">Historique</a>
    </nav>
  </header>

  <h1>DonnÃ©es Capteur LoRa</h1>
  <p>ğŸŒ¡ TempÃ©rature : <span id="temperature">...</span> Â°C</p>
  <p>ğŸ’§ HumiditÃ© : <span id="humidity">...</span> %</p>

  <div class="container">
    <div class="section">
      <h2>Carte modifiable de la serre</h2>
      <div class="map-placeholder">
        (Ici 1)
      </div>
    </div>

    <div class="section indicators">
      <div class="indicator temp">TempÃ©rature</div>
      <div class="indicator co2">COâ‚‚</div>
      <div class="indicator hum">HumiditÃ©</div>
    </div>

    <div class="section">
      <h3>PrÃ©visions (conseils IA)</h3>
      <textarea rows="4"></textarea>
    </div>

    <div class="section">
      <h3>Actions</h3>
      <div class="actions">
        <label>Modifier la tempÃ©rature :
          <button>-</button>
          <span>24Â°C</span>
          <button>+</button>
        </label>
        <label>Modifier la ventilation :
          <button>Ouvrir/Fermer</button>
        </label>
        <span class="small-text">Autres options</span>
        <label>Capteur :
          <select>
            <option value="">SÃ©lectionner</option>
          </select>
        </label>
      </div>
    </div>
  </div>

  <script>
  const options = {
    username: 'mqtt-access@ttn',
    password: 'NNSXS.LJDO5CK3GZ6ORBP6RQ3DDQBIDUXOA73RSEUEB5Y.7N6NA427MLRFJEGKV62WMNTLB3R6L6BDNUBHDQVDEX6PMGXTKXHQ',
    protocol: 'wss'
  };

  const client = mqtt.connect('wss://eu1.cloud.thethings.network/mqtt', options);

  client.on('connect', () => {
    console.log("ConnectÃ© Ã  TTN MQTT");
    client.subscribe('v3/tonAppID@ttn/devices/+/up');
  });

  client.on('message', (topic, message) => {
    const json = JSON.parse(message.toString());
    const payload = json.uplink_message.decoded_payload;

    document.getElementById('temperature').textContent = payload.temperature;
    document.getElementById('humidity').textContent = payload.humidity;
  });
  </script>

</body>
</html>
