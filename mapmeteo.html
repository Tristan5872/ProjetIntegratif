<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Double carte m√©t√©o</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .buttons {
      margin: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 10px 16px;
      border: none;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      cursor: pointer;
      font-weight: bold;
    }

    .map-row {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }

    .map-container {
      margin-top: 15px;
      width: 480px;
      height: 380px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.3);
      border: 1px solid #ccc;
      background: white;
    }

    .map-title {
      text-align: center;
      font-weight: bold;
      margin: 10px 0;
    }

    .leaflet-container {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>

  <h2>Bienvenue sur la page m√©t√©o</h2>
  <div class="buttons" id="day-buttons"></div>

  <div class="map-row">
    <div class="map-container">
      <div class="map-title">Pr√©visions matin (9h)</div>
      <div id="map-now"></div>
    </div>
    <div class="map-container">
      <div class="map-title">Pr√©visions 15h</div>
      <div id="map-forecast"></div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const apiKey = "f73e9c1ed2c8007ded08388c1007780e";
    const villes = [
      { nom: "Ma serre connect√©e", lat: 45.6368313960361, lon: 1.00846847343737, offset: [25, 40] },
      { nom: "Limoges", lat: 45.8336, lon: 1.2476, offset: [25, 40] },
      { nom: "Brive", lat: 45.1591, lon: 1.533, offset: [25, 40] },
      { nom: "P√©rigueux", lat: 45.184, lon: 0.7211, offset: [25, 40] },
    ];

    const joursSemaine = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"];
    const today = new Date();
    const jours = Array.from({ length: 7 }, (_, i) => {
      const date = new Date();
      date.setDate(today.getDate() + i);
      return { label: joursSemaine[date.getDay()], date };
    });

    const mapNow = L.map("map-now").setView([45.7, 1.2], 9);
    const mapForecast = L.map("map-forecast").setView([45.7, 1.2], 9);
    [mapNow, mapForecast].forEach(map =>
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: '&copy; OpenStreetMap'
      }).addTo(map)
    );

    function afficherPrevisions(map, villes, targetDate, targetHour) {
      map.eachLayer(layer => {
        if (layer instanceof L.Marker || layer instanceof L.CircleMarker) {
          map.removeLayer(layer);
        }
      });

      villes.forEach(ville => {
        const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${ville.lat}&lon=${ville.lon}&units=metric&lang=fr&appid=${apiKey}`;
        fetch(url)
          .then(res => res.json())
          .then(data => {
            const item = data.list.find(f => {
              const dt = new Date(f.dt_txt);
              return dt.getDate() === targetDate.getDate() && dt.getHours() === targetHour;
            });

            if (!item) return;

            const icon = item.weather[0].icon;
            const iconUrl = `https://openweathermap.org/img/wn/${icon}@2x.png`;
            const popup = `
              <strong>${ville.nom}</strong><br>
              <img src="${iconUrl}" style="height: 1.4em;"> ${item.weather[0].description}<br>
              üå°Ô∏è ${Math.round(item.main.temp)}¬∞C<br>
              üíß ${item.main.humidity}%
            `;

            const marker = L.marker([ville.lat, ville.lon], {
              icon: L.icon({ iconUrl, iconSize: [50, 50], iconAnchor: ville.offset })
            }).addTo(map);
            marker.bindPopup(popup);
          });
      });
    }

    const buttonContainer = document.getElementById("day-buttons");
    jours.forEach(j => {
      const btn = document.createElement("button");
      btn.textContent = j.label;
      btn.onclick = () => {
        afficherPrevisions(mapNow, villes, j.date, 9);
        afficherPrevisions(mapForecast, villes, j.date, 15);
      };
      buttonContainer.appendChild(btn);
    });

    // Initial load for today
    afficherPrevisions(mapNow, villes, today, 9);
    afficherPrevisions(mapForecast, villes, today, 15);
  </script>
</body>
</html>
