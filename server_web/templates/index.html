<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tableau de Bord</title>

  <!-- Lien vers la feuille de style -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- Favicon -->
  <link rel="icon" href="{{ url_for('static', filename='ressources/logo-serre.png') }}" type="image/png">

  <!-- Client MQTT via CDN -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>
<body>
  <!-- En-t√™te avec navigation -->
  <header>
    <div><strong>Serre Connect√©e</strong></div>
    <nav>
      <a href="{{ url_for('home') }}" class="active">Accueil</a>
      <a href="{{ url_for('meteo') }}">M√©t√©o</a>
      <a href="{{ url_for('historique') }}">Historique</a>
    </nav>
  </header>

  <!-- Carte (ex : plan de la serre) -->
  <div class="section">
    <h2>Carte modifiable de la serre</h2>
    <div class="map-placeholder">(Ici 1)</div>
  </div>

  <!-- Indicateurs capteurs -->
  <div class="container">
    <!-- Donn√©es capteur int√©rieur -->
    <div class="section indicators">
      <h3>Int√©rieur</h3>
      <div class="indicator temp">Temp√©rature <p id="temperature-int"></p></div>
      <div class="indicator co2">CO‚ÇÇ <p id="co2-int"></p></div>
      <div class="indicator hum">Humidit√© <p id="humidity-int"></p></div>
    </div>

    <!-- Donn√©es capteur ext√©rieur -->
    <div class="section indicators">
      <h3>Ext√©rieur</h3>
      <div class="indicator temp">Temp√©rature <p id="temperature-ext"></p></div>
      <div class="indicator hum">Humidit√© <p id="humidity-ext"></p></div>
    </div>
  </div>

  <!-- Pr√©visions m√©t√©o / IA -->
  <div class="section">
    <h3>Pr√©visions (conseils IA)</h3>
    <textarea rows="4"></textarea>
  </div>

  <!-- Section des actions (commandes manuelles) -->
  <div class="section">
    <div class="actions-header">
      <h3>Actions</h3>

      <!-- Choix du capteur cibl√© -->
      <div>
        <label for="sensor-select" class="action-label">Capteur :</label>
        <select id="sensor-select">
          <option value="">S√©lectionner</option>
          <option value="interieur">Capteur Int√©rieur</option>
          <option value="exterieur">Capteur Ext√©rieur</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <!-- Action temp√©rature -->
      <div class="action-group">
        <label for="temperature_action" class="action-label">Modifier la temp√©rature :</label>
        <button id="decrease" aria-label="Diminuer temp√©rature">‚àí</button>
        <span id="temperature_action" class="action-value">24¬∞C</span>
        <button id="increase" aria-label="Augmenter temp√©rature">+</button>
      </div>

      <!-- Action ventilation -->
      <div class="action-group">
        <label class="action-label">Modifier la ventilation :</label>
        <button id="btn-ouvrir" class="vent-btn">Ouvrir</button>
        <button id="btn-fermer" class="vent-btn">Fermer</button>
      </div>

      <!-- Arrosage -->
      <div class="action-group">
        <label class="action-label" for="arrosage_duree">Commande d‚Äôarrosage :</label>
        <input type="number" id="arrosage_duree" placeholder="Dur√©e (min)" min="1" max="60">
        <button id="btn-arroser">Lancer</button>
      </div>

      <!-- √âclairage -->
      <div class="action-group">
        <label class="action-label" for="eclairage_duree">Commande d‚Äô√©clairage :</label>
        <input type="number" id="eclairage_duree" placeholder="Dur√©e (min)" min="1" max="60">
        <button id="btn-eclairer">Allumer</button>
      </div>

      <!-- Zone future pour options avanc√©es -->
      <div class="other-options">
        <span class="small-text">Autres options</span>
      </div>
    </div>
  </div>

  <!-- Script d'interaction locale (temp√©rature, boutons, etc.) -->
  <script>
    // === Temp√©rature ===
    const tempDisplay = document.getElementById("temperature_action");
    const increaseBtn = document.getElementById("increase");
    const decreaseBtn = document.getElementById("decrease");
    let temperature = parseInt(tempDisplay.textContent);

    increaseBtn.addEventListener("click", () => {
      temperature += 1;
      tempDisplay.textContent = `${temperature}¬∞C`;
    });

    decreaseBtn.addEventListener("click", () => {
      temperature -= 1;
      tempDisplay.textContent = `${temperature}¬∞C`;
    });

    // === Ventilation ===
    const btnOuvrir = document.getElementById("btn-ouvrir");
    const btnFermer = document.getElementById("btn-fermer");

    btnOuvrir.addEventListener("click", () => {
      // Gestion des classes CSS pour illustrer l'√©tat
      btnOuvrir.classList.add("ouvert");
      btnFermer.classList.remove("ferme", "ouvert");
      btnOuvrir.classList.remove("ferme");
    });

    btnFermer.addEventListener("click", () => {
      btnFermer.classList.add("ferme");
      btnOuvrir.classList.remove("ouvert", "ferme");
      btnFermer.classList.remove("ouvert");
    });

    // === Arrosage ===
    const arroserBtn = document.getElementById("btn-arroser");
    const arrosageInput = document.getElementById("arrosage_duree");

    arroserBtn.addEventListener("click", () => {
      const minutes = parseInt(arrosageInput.value);
      if (!isNaN(minutes) && minutes > 0) {
        console.log(`Arrosage lanc√© pour ${minutes} minutes`);
        // üëâ Ajouter ici un publish MQTT si besoin
      } else {
        alert("Merci d‚Äôentrer une dur√©e valide pour l‚Äôarrosage.");
      }
    });

    // === √âclairage ===
    const eclairerBtn = document.getElementById("btn-eclairer");
    const eclairageInput = document.getElementById("eclairage_duree");

    eclairerBtn.addEventListener("click", () => {
      const minutes = parseInt(eclairageInput.value);
      if (!isNaN(minutes) && minutes > 0) {
        console.log(`√âclairage lanc√© pour ${minutes} minutes`);
        // üëâ Ajouter ici un publish MQTT si besoin
      } else {
        alert("Merci d‚Äôentrer une dur√©e valide pour l‚Äô√©clairage.");
      }
    });
  </script>

  <!-- Scripts externes (fonctionnalit√© MQTT, envoi/lecture donn√©es, etc.) -->
  <script src="{{ url_for('static', filename='js/envoyerDonnees.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/connexionMQTT.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/recupererDonnees.js') }}" defer></script>
</body>
</html>
